## シンプルなサンプル

### まずは作ってみよう

コネクタから電源を受け取り、LEDを点灯させるだけの回路を作りましょう。
回路図で書くと、以下のようになります。

![First_simple_sample_schematic](resource\First_simple_sample\schematic.png)

### コーディングと翻訳

テキストエディタに以下のソースコードを打ち込み、「Sample1.eis」というファイル名で保存します。
このソースコードが何を意味するかは後ほど説明します。

```Sample1.eis
defpart CN(1:VIN 2:GND){ref "CN";}
defpart R(1:1 2:2){ref "R";}
defpart LED(1:A 2:K){ref "LD";}

defmodule main()
{
  part cn "PSS-410153-02" as CN;
  part led "BR1111C" as LED;
  part r "330 5% 1608" as R;

  wire VIN, GND;

  cn.VIN - VIN;
  cn.GND - GND;

  VIN - A.led.K - 1.r.2 - GND;
}
```

次に、お好みのコマンドラインシェルを開き、上記ファイルを保存したディレクトリに移動します。
そして以下のコマンドを実行してください。

```
> ket Sample1.eis
```

この処理を翻訳といいます。

エラーがなければ何も表示されずに翻訳は完了し、以下の５つのファイルが作られます。

* ConInfo.md (各部品ごとの結線情報)
* README.md (翻訳結果のサマリ)
* Sample1.asc (PADS用のネットリスト)
* Sample1.csv (部品表)
* Sample1.net (KiCad用のネットリスト)

### KiCadでの作業

KiCad用のネットリストが作成されるので、このネットリストをもとにアートワークを行います。
今回は、KiCadのバージョンとして「BZR 4022」を使用します。
これはいわゆるKiCad本(トランジスタ技術SPECIAL No.127)に付属していたバージョンです。
古いバージョンですが、最新のKiCad4系ではKiCad以外で作成したネットリストをインポートできないようですので、やむを得ずこのバージョンとしています。
このバージョンのKiCadはいまでもKiCadの日本ユーザコミュニティ( http://kicad.jp/ )からダウンロードすることができます。

このドキュメントでは、KiCadそのものの操作方法について詳細な説明はしません。

#### プロジェクトの新規作成

KiCadを起動し、メニューから「ファイル→新規→プロジェクトを新規作成」を選んで新しいプロジェクトを作成します。
プロジェクト名はSample1.proとしました。

#### CvPcbによるフットプリントの関連付け

通常、KiCadで基板を開発する場合は、まずEESchemaを使って回路図を描きます。
しかしEislerを使う場合は回路図は不要で、部品とフットプリントを関連付けする作業から開始することになります。

KiCadのメインウィンドウの左から2番目のアイコンをクリックし、CvPcbを起動します。

![KiCad_main_CvPcb](resource\First_simple_sample\KiCad_main_CvPcb.png)

![CvPcb](resource\First_simple_sample\CvPcb.png)

CvPcbが起動したら、メニューから「ファイル→開く」を選び、Sample1.netを選択します。
「コンポーネント ライブラリ エラー」が出ますが、問題ありませんのでそのままOKをクリックしてください。

![CvPcb_file_opened](resource\First_simple_sample\CvPcb_file_opened.png)

部品にフットプリントを割り当てていきます。

|リファレンス|フットプリント|
|-|-|
|CN1|PIN_ARRAY_2X1|
|LD1|LED-0603|
|R1|SM0603|

![CvPcb_assoc](resource\First_simple_sample\CvPcb_assoc.png)

関連付けが終わったら、メニューの「ファイル→保存」をクリックして、ネットリストを保存します。

#### Pcbnewによるアートワーク

これでアートワーク作業を開始する準備が整いました。
KiCadのメインウィンドウの左から3番目のアイコンをクリックし、Pcbnewを起動します。

![KiCad_main_CvPcb](resource\First_simple_sample\KiCad_main_Pcbnew.png)

「ファイル<〇〇.kicad_pcb>は存在しません」というエラーが出ますが、問題ありませんので、OKをクリックしてください。

メニューの「ツール→ネットリスト」をクリックします。
現れたネットリストウィンドウの右上に並んでいるボタンから「ネットリスト ファイルを参照する」をクリックし、先ほどSample1.netを選択します。
「現在のネットリストを読み込む」をクリックすると、ネットリストとフットプリントがPcbnewに読み込まれます。
「閉じる」を押してネットリストウィンドウを閉じると「プロジェクトの設定が変更されました、保存しますか？」と聞かれるので、「はい」を選びましょう。

Pcbnew上でのアートワーク作業の操作方法は他のドキュメントに譲ります。

![Pcbnew_aw](resource\First_simple_sample\Pcbnew_aw.png)

アートワーク作業をしていると、「GND-main」や「VIN-main」という名前のネットリストに気付くでしょう。
これは、「mainモジュールのGNDというワイヤ」「mainモジュールのVINというワイヤ」を意味しています。
大電流が流れるとわかっているネットや差動ペアだとわかっているネットはアートワーク時に配慮が必要ですが、その時はこのネット名を参考にすることになります。

勘の鋭い方はもうお気づきかもしれませんが、このネット名はソースコードのなかの`wire VIN, GND;`という記述に由来しています。
詳細は別途説明しますが、わかりやすいネット名をつけると、アートワークの際に便利です。

#### プリント基板の製造

プリント基板の発注の手順は製造業者によって様々です。
本ドキュメントでは詳細には触れませんが、Fusion PCB( https://fusionpcb.jp/ )やPCBGOGO( https://www.pcbgogo.jp/ )などの格安基板メーカーへの製造依頼の手順は個人のブログ等で詳細に説明されています。

#### 部品の調達

ketはソースコードから自動的に部品表を生成します。
今回のケースですとSample1.csvがそれです。
通常であれば、この部品表をもとに必要な部品を手配しますが、少量の部品をネットショップで購入する場合はREADME.mdを利用するのが便利です。

README.mdはMarkdownで書かれた翻訳結果のサマリーです。
README.mdをお好みのMarkdownレンダラで開いてください。
本ドキュメントで例示するものは、MarkDown Preview PlusというChrome用のアドオンを用いてレンダリングしたものです。

![README.md](resource\First_simple_sample\README.md.png)

話を元に戻しましょう。
README.mdのBOMの欄を見ると、今回の基板に必要な部品のリファレンス、型番、数量が一覧になっています。
そしてその右側には、その型番でそれぞれアールエスコンポーネンツ、Google、Digikey、Chip1Stopで検索した結果へのリンクが貼られています。

試しにBR1111CをRSで検索してみましょう。

![BR1111C_at_RS.md](resource\First_simple_sample\BR1111C_at_RS.png)

本ドキュメント執筆時点(2017/08/09)では、お目当てのBR1111Cがヒットしました。

PSS-410153-02はいずれのネットショップでもヒットせず、Googleで検索した結果から、メーカーの廣杉計器にたどり着きました。

330 5% 1608はチップ抵抗ですが、これはアールエスでヒットしました。

### 部品の実装

プリント基板と部品が手元に届いたら、残るは実装のみです。
部品の極性に気を付けながらはんだ付けしましょう。

Fusion PCBやPCBGOGOにはステンシル(メタルマスク)を製造するサービスもあります。
細かな面実装部品をたくさん使用する場合には、ホットプレートを用いたリフローはんだ付けが便利です。
