## サンプルの解説

前章ではEislerとKiCadを使った基板の作り方を一通り見ました。
この章では、前章で例示したソースコードの意味するものを説明します。

ソースコードを再度見てみましょう。

```Sample1.eis
defpart CN(1:VIN 2:GND){ref "CN";}
defpart R(1:1 2:2){ref "R";}
defpart LED(1:A 2:K){ref "LD";}

defmodule main()
{
  part cn "PSS-410153-02" as CN;
  part led "BR1111C" as LED;
  part r "330 5% 1608" as R;

  wire VIN, GND;

  cn.VIN - VIN;
  cn.GND - GND;

  VIN - A.led.K - 1.r.2 - GND;
}
```

このソースコードは先頭から順に、以下について書かれています。
* パーツの定義
* mainモジュールの定義
* パーツの宣言
* ワイヤの宣言
* 結線

それぞれがどんな意味を持つか、1つずつ見ていきましょう。

### パーツの定義

最初の3行はパーツの定義です。

```
defpart CN(1:VIN 2:GND){ref "CN";}
defpart R(1:1 2:2){ref "R";}
defpart LED(1:A 2:K){ref "LD";}
```

`defpart`というキーワードに続いてパーツ名、ピン番号とピン名、リファレンスの接頭辞が書かれています。

パーツ名は説明不要ですね。`CN`はコネクタ、`R`は抵抗、`LED`はそのまんまLEDです。

ピン番号は必ず数字で指定してください。ピン名には数字以外も使うことができます。後で結線について説明しますが、パーツのピン同士を接続するときには、このピン名でピンを指定します。

リファレンスの接頭辞については、少し説明が必要です。
部品表やネットリストでは各部品はリファレンスで表現されます。
コンデンサであればC1とか、トランジスタならTR3といったリファレンスを使いますよね。
リファレンスのうち、数字の部分はEislerが自動的に割り振ります。
各部品ごとにどのような接頭辞を用いるかをここで指定します。
例えばここで`"R"`と指定すると、その部品にはR1やR3といった、R+数字というリファレンスが与えられます。

### mainモジュールの定義

```
defmodule main()
```

モジュールとはひと塊の回路のことです。
そして、mainモジュールはEislerで書かれた回路全体を表すモジュールです。
mainモジュールの定義は「ここから先に、{}で囲んでmainモジュールがどんなものかを書きますよ」ということをEislerの処理系に伝えます。

### パーツの宣言

```
part cn "PSS-410153-02" as CN;
part led "BR1111C" as LED;
part r "330 5% 1608" as R;
```

パーツの宣言とパーツの定義は似ているようで全く異なるものです。
先に登場したパーツの定義では、そのパーツがどんなピンを持っていて、どんなリファレンスをつけるのかを決めていました。
パーツの宣言は、定義されたパーツを実際に使うためにその実体(=インスタンス)を用意します。

`part`というキーワードの後に、インスタンスの名前を書き、続いてダブルクオーテーションで囲んで型番を書きます。さらに`as`に続けてパーツ名を書き、最後にセミコロン`;`を書いて、パーツの宣言は終わりです。

お気づきかもしれませんが、定義されたパーツと宣言されたパーツでは抽象度が異なります。
`defpart R(1:1 2:2){ref "R";}`と定義された抵抗は、まだそれがどんな抵抗値を持っていて、どんなパッケージで、という情報を持っていません。
それらの情報は、パーツを宣言する際に型番を記述するという形で付与されます。

別の言い方をすると、定義されたパーツ`R`は回路図でいうところの回路記号のようなものです。
抵抗の回路記号そのものには抵抗値やパッケージの情報はありません。
宣言されたパーツは回路図に実際に書かれた抵抗です。回路記号に抵抗値やパッケージといった情報を追記して使います。

### ワイヤの宣言

ワイヤはピンとピンをつなぐ配線に名前を付けるものです。

```
wire VIN, GND;
```

ワイヤの名前は、ネットリストにネット名として反映されます。
そして、異なるワイヤどうしを結線することはできません。

ですから、重要な配線にはワイヤを使って名前を付けることを推奨します。

### 結線

```
cn.VIN - VIN;
cn.GND - GND;

VIN - A.led.K - 1.r.2 - GND;
```

結線は、ピン同士やピンとワイヤを配線で接続します。
接続はハイフン`-`で行い、パーツのピンはパーツのインスタンス名にドット`.`とピン名を書くことで、接続するピンを指定します。
ですので`cn.VIN - VIN;`は、`cn`のピン`VIN`をワイヤ`VIN`とつなぐ、という意味です。
`cn`は先に宣言されたパーツのインスタンスで、そのパーツ名は`CN`でした。
`CN`はピンとして1ピンの`VIN`と、2ピンの`GND`を持っていたことを思い出してください。

ところで、結線に向きはありませんから、`VIN - cn.VIN;`と書いてもいいような気がしますね。
結線に向きがないのは正しいのですが、この書き方はNGです。
ワイヤ`VIN`を先に書く場合、`VIN - VIN.cn;`と書かなくてはいけません。
つまり、`-`がある方向にピン名を書きます。

さて、このルールのおかげで最後の行ような結線の書き方ができます。
```
VIN - A.led.K - 1.r.2 - GND;
```

これは、以下のように書くのと同じです。

```
VIN - A.led;
led.K - 1.r;
r.2 - GND;
```

どちらの書き方をしてもかまいません。
その時々で読みやすい方を選んでください。
