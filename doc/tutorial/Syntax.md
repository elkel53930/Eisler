# 構文

ここまでのサンプルを読んでくださった皆さんは、Eislerの構文はおおよそ理解できているかと思います。
ですがこの章では、改めて各構文の詳細を説明し、皆さんにより一層理解を深めてもらおうと思います。

## 表記法

Eislerの構文を説明する前に、Eislerのコードを構成する要素を説明します。
要素は識別子、自然数、文字列リテラル、キーワード、コメント、演算子と呼ばれ、それぞれに表記法が決まっています。

### 識別子

識別子は数字、アルファベット、アンダースコアから成る文字列です。
パーツ名やモジュール名、ピン名、ワイヤ名、インターフェイス名に使用することができます。

C言語などでは、識別子を数字で始めることはできませんが、Eislerでは可能です。
なので、`12V`や`100`もEislerでは識別子として使うことができます。

大文字と小文字は区別されます。
例えば`Register`と`register`は異なる識別子です。

* 有効な識別子
 * `Register`
 * `R5F5631PDDFL`
 * `12V`
 * `5`
 * `_a`
 * `AB_`
* 無効な識別子
 * `LTC4054-4.2` (-や.は使えない)
 * `VOUT@REG` (@は使えない)

### 自然数

自然数は数字から成る文字列です。
Eislerではピン番号の指定に使用します。
マイナスの値は使用できません。

* 有効な自然数
 * `0`
 * `5`
 * `42`
 * `001` (先頭の0は無視され、この場合は1として扱われる)
 * `020`
* 無効な自然数
 * `-10` (マイナスは使えない)
 * `0.15` (少数は使えない)
 * `5*2` (演算は使えない)

### 文字列リテラル

文字列リテラルはダブルクオーテーション「"」で囲まれた文字列です。
部品型番とリファレンスの接頭辞に使用します。

文字列リテラルにダブルクオーテーションを使用することはできませんが、ダブルクオーテーションと改行以外なら使用することができます。

* 有効な文字列リテラル
 * `"LTC4054-4.2"`
 * `"5000"`
 * `"100 5% 2012"`
 * `"0.01u 50V X5R 1608"`
* 無効な文字列リテラル
 * `BR1111C` (ダブルクオーテーションで囲む必要がある)
 * `"2SC1815` (最後のダブルクオーテーションがない)
 * `2SA1015"` (最初のダブルクオーテーションがない)

### キーワード

キーワードの一覧は以下の通りです。

```
defmodule defpart part module
as import wire interface
```

### 演算子

演算子の一覧は以下の通りです。

```
{ } ( ) : ; -
```

### コメント

コメントには、`//`で始まり改行までをコメントとするラインコメントと、
`/*`と`*/`で囲まれた箇所をコメントするブロックコメントがあります。
ブロックコメントには改行を含めることができます。
Eislerの処理系はコメントを無視します。

* 有効なコメント
 * `// comment`
 * `/* comment */`
 * `// /* comment */`
 * `/* // comment */`
* 無効なコメント
 * `comment` (`//`がない)
 * `/* comment` (`*/`がない)

## 構文

以下では、説明のために次のような記述を用います。

```
defpart <i:パーツ名>(<n:ピン番号1>:<i:ピン名1> <n:ピン番号2>:<i:ピン名2> ... )
{
 ref <s:リファレンスの接頭辞>;
}
```

つまり、そこに何を記述すればいいのかを「<>」で囲んだ自然言語で説明します。
<>の先頭にi, n ,sというアルファベットが書かれていますが、これは、そこに記述するものが識別子=iなのか、自然数=nなのか、文字列リテラル=sなのかを表しています、

例えば、`<n:ピン番号1>`はピン番号を自然数で記述することを意味します。`10`や`42`ですね。
`<s:リファレンスの接頭辞>`であれば、リファレンスの接頭辞を文字列リテラルで記述することを意味します。その部品が集積回路なら`"IC"`と書くでしょうし、ダイオードなら`"D"`と書くでしょう。

### defpart

`defpart`は部品を定義する構文です。

```
defpart <i:パーツ名>(<n:ピン番号1>:<i:ピン名1> <n:ピン番号2>:<i:ピン名2> ... )
{
 ref <s:リファレンスの接頭辞>;
}
```

例：

```
defpart NchFET(1:Gate 2:Drain 3:Source)
{
  ref "Q";
}
```
#### パーツ名

パーツ名はほかのパーツ名やモジュール名、ワイヤ名、インターフェイス名と重複してはいけません。
またパーツ名は識別子なので、`.`や`-`を使うことはできません。

#### ピン番号

ピン番号は自然数で指定します。ネットリストにおいては、ある部品のピンは、部品のリファレンスとピン番号で表現されるので、ピン番号は実際のパッケージのピン番号と同じにしておくべきです。
部品によっては、複数のパッケージがあり、パッケージごとにピン番号が異なる場合があります。そういう時は、パッケージごとにパーツを定義することを推奨します。

#### ピン名

ピン名には各ピンの機能を端的に表した名前を使うといいでしょう。
例えばFETであれば、各ピンの名前は`Gate`, `Drain`, `Source`で良いでしょう。
電解コンデンサなら`Plus`と`Minus`とか、省略して`P`と`M`でもいいかもしれません。
極性のない抵抗やセラミックコンデンサの場合は`1`と`2`などとしておくとキーの入力量を減らすことができます(Eislerでは1や2など、数字だけから成る文字列も識別子として使えることを思い出してください)。

#### リファレンスの接頭辞

次のように異なる部品が同じリファレンスの接頭辞を使用することができます。

```
defpart CeramicC)(1:1 2:2){ref "C";}
defpart CemicalC)(1:P 2:M){ref "C";} // Same ref prefix as CeramicC.

defmodule main()
{
  ...
  part ceraC as CeramicC;
  part cemiC as CemicalC;
  ...
}
```

### defmodule

`defmodule`はモジュールを定義する構文です。

```
defmodule <i:モジュール名>(<n:ピン番号1>:<i:ピン名1> <n:ピン番号2>:<i:ピン名2> ... )
```

`defmodule`のあとには中括弧`{}`で囲んで、パーツ、モジュール、ワイヤー、インターフェイスの宣言やピン間の結線を記述します(後述)。


#### モジュール名

モジュール名はほかのモジュール名やパーツ名、ワイヤ名、インターフェイス名と重複してはいけません。
またモジュール名は識別子なので、`.`や`-`を使うことはできません。

#### ピン番号

ピン番号は自然数で指定します。
モジュールの定義にピン番号は不要なのでは…と思うかもしれませんが、** 気にしてはいけません。 **

#### ピン名

ピン名には各ピンの機能を端的に表した名前を使うといいでしょう。

### part

`part`はパーツを宣言する構文です。

```
part <i:パーツのインスタンス名1>, <i:パーツのインスタンス名2> ... <s:パーツの型番> as <i:パーツ名>;
```

パーツのインスタンス名は1つ以上必要です。
パーツの型番は省略可能です。

例：

```
part r as R;
part pullup "10k 5% 1608" as R;
part c1, c2, c3 "1u 50V X5R 2012" as C;
part led1, led2 as LED;
```

#### パーツのインスタンス名

パーツのインスタンス名は、そのパーツの使用目的が分かるようにつけるといいでしょう。
プルアップ抵抗であればpullUpRegなどです。

#### パーツの型番

この情報はTranslation Summaryや部品表に反映されます。
文字列リテラルで記述するため、ダブルクオーテーションや改行をのぞく文字を使用することができます。

Translation Summaryには、この型番をキーワードとして、アールエスコンポーネンツやGoogle、Digikey、チップワンストップで検索を行うためのリンクが含まれます。

#### パーツ名

`defpart`で指定したパーツ名を記述します。

### module

`module`はモジュールを宣言する構文です。

```
part <i:モジュールのインスタンス名1>, <i:モジュールのインスタンス名2> ... as <i:モジュール名>;
```

パーツのインスタンス名は1つ以上必要です。

例：

```
module pwr as 5VPower;
module iso1, iso2, iso3 as Isolator;
```

#### モジュールのインスタンス名

モジュールのインスタンス名はそのモジュールの使用目的が分かるようにつけるといいでしょう。
デジタル電源のモジュールであれば、digiPwrなどです。

#### モジュール名

`defpart`で指定したパーツ名を記述します。

### wire

`wire`はワイヤを宣言する構文です。

```
wire <i:ワイヤ名1>, <i:ワイヤ名2> ... ;
```

ワイヤ名は1つ以上必要です。

例：

```
wire CLOCK;
wire VCC, GND;
```

#### ワイヤ名

ワイヤ名はそのワイヤの使用目的が分かるように付けるといいでしょう。
グランドであればGND、SPI通信のクロックであればSCLKなどです。

Eislerの処理系が出力するネットリストでは、ワイヤ名はネット名に利用されます。
分かりやすい名前を付けておけば、アートワークの際にも便利です。

### interface

`interface`はワイヤを宣言する構文です。

```
interface <i:インターフェイス名1>, <i:インターフェイス名2> ... ;
```

インターフェイス名は1つ以上必要です。

例：

```
interface PUSH_SIGNAL;
wire RS485A, RS485B;
```

#### インターフェイス名

インターフェイス名はワイヤと同じく、そのインターフェイスの使用目的が分かるように付けるといいでしょう。
